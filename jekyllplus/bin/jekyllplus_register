#!/usr/bin/env bash
#######################
#
# Register a new repo on jekyllplus platform
#
#######################

URL="$1"
TOKEN="$2"
OWNER="$3"
REPO="$4"

BASE_REPO=/opt/repos

if [ -z "$URL" ]; then
    echo 'Missing repo URL' >&2
    exit 1
fi

if [ -z "$TOKEN" ]; then
    echo 'Missing Oauth token' >&2
    exit 1
fi

if [ -z "$OWNER" ]; then
    echo 'Missing owner' >&2
    exit 1
fi

if [ -z "$REPO" ]; then
    echo 'Missing repo name' >&2
    exit 1
fi


if [ -e "$BASE_REPO/$OWNER/$REPO" ]; then
    echo 'Repo already existing' >&2
    exit 1
fi

mkdir -p $BASE_REPO/$OWNER/$REPO
cd $BASE_REPO/$OWNER/$REPO

git clone --bare --shared https://$TOKEN:x-oauth-basic@github.com/$URL .
