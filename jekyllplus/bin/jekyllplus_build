#!/usr/bin/env bash
#######################
#
# Build/refresh a new site
#
#######################

OWNER="$1"
REPO="$2"
BRANCH="$3"
ORIG_BRANCH="$3"

BASE_REPO=/opt/repos
BASE_SITE=/var/www

if [ -z "$OWNER" ]; then
    echo 'Missing owner' >&2
    exit 1
fi
if [ -z "$REPO" ]; then
    echo 'Missing repo' >&2
    exit 1
fi

if [ -z "$BRANCH" ]; then
    echo 'Missing branch' >&2
    exit 1
fi

if [ ! -e "$BASE_REPO/$OWNER/$REPO" ]; then
    echo 'Repo is not registered' >&2
    exit 1
fi

cd $BASE_REPO/$OWNER/$REPO
git fetch origin $ORIG_BRANCH:$ORIG_BRANCH

mkdir -p $BASE_SITE/$OWNER/$REPO/$BRANCH
cd $BASE_SITE/$OWNER/$REPO/$BRANCH

# Either update or clone
if [ -e '.git' ]; then
    git pull
else
    git clone -b $ORIG_BRANCH $BASE_REPO/$OWNER/$REPO .
fi

# Run the jekyll build
# need to see how