<!doctype html>
<html>
<head>
  <link rel='canonical' href='http://wiredcraft.github.io/egg/'/>

  <title>A SASS boilerplate | egg</title>

  <meta charset='utf-8'/>
  <meta http-equiv='Content-Language' content='en'/>
  <meta name='viewport' content='width=device-width, initial-scale=1'/>
  <meta name='keywords' content='iconset, icons, design, lineart'/>
  <meta name='description' content='A simple SASS/Bourbon boilerplate'>

  <!-- CSS -->
  <link rel='stylesheet' href='main.css'>
</head>

<body>
  <div id='app'>
    <nav id='menu'>
      <header class='header'>
        <a class='logo'>
          <svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' version='1.1' baseProfile='full' width='24' height='24' viewBox='0 0 24.00 24.00' enable-background='new 0 0 24.00 24.00' xml:space='preserve'>
          	<path stroke-width='1.33333' stroke-linejoin='miter' d='M 7,2L 7,4L 8,4L 8,18C 8,20.2 9.8,22 12,22C 14.2,22 16,20.2 16,18L 16,4L 17,4L 17,2L 7,2 Z M 11,16C 10.4,16 10,15.6 10,15C 10,14.4 10.4,14 11,14C 11.6,14 12,14.4 12,15C 12,15.6 11.6,16 11,16 Z M 13,12C 12.4,12 12,11.6 12,11C 12,10.4 12.4,10 13,10C 13.6,10 14,10.4 14,11C 14,11.6 13.6,12 13,12 Z M 14,7L 10,7L 10,4L 14,4L 14,7 Z '/>
          </svg>
          Jekyll+
        </a>
        <span class='dropdown'>
          <a class='icon'>
            <svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' version='1.1' baseProfile='full' width='24' height='24' viewBox='0 0 24.00 24.00' enable-background='new 0 0 24.00 24.00' xml:space='preserve'>
            	<path stroke-width='0.2' stroke-linejoin='round' d='M 11.9994,15.498C 10.0664,15.498 8.49939,13.931 8.49939,11.998C 8.49939,10.0651 10.0664,8.49805 11.9994,8.49805C 13.9324,8.49805 15.4994,10.0651 15.4994,11.998C 15.4994,13.931 13.9324,15.498 11.9994,15.498 Z M 19.4284,12.9741C 19.4704,12.6531 19.4984,12.329 19.4984,11.998C 19.4984,11.6671 19.4704,11.343 19.4284,11.022L 21.5414,9.36804C 21.7294,9.21606 21.7844,8.94604 21.6594,8.73004L 19.6594,5.26605C 19.5354,5.05005 19.2734,4.96204 19.0474,5.04907L 16.5584,6.05206C 16.0424,5.65607 15.4774,5.32104 14.8684,5.06903L 14.4934,2.41907C 14.4554,2.18103 14.2484,1.99805 13.9994,1.99805L 9.99939,1.99805C 9.74939,1.99805 9.5434,2.18103 9.5054,2.41907L 9.1304,5.06805C 8.52039,5.32104 7.95538,5.65607 7.43939,6.05206L 4.95139,5.04907C 4.7254,4.96204 4.46338,5.05005 4.33939,5.26605L 2.33939,8.73004C 2.21439,8.94604 2.26938,9.21606 2.4574,9.36804L 4.5694,11.022C 4.5274,11.342 4.49939,11.6671 4.49939,11.998C 4.49939,12.329 4.5274,12.6541 4.5694,12.9741L 2.4574,14.6271C 2.26938,14.78 2.21439,15.05 2.33939,15.2661L 4.33939,18.73C 4.46338,18.946 4.7254,19.0341 4.95139,18.947L 7.4404,17.944C 7.95639,18.34 8.52139,18.675 9.1304,18.9271L 9.5054,21.577C 9.5434,21.8151 9.74939,21.998 9.99939,21.998L 13.9994,21.998C 14.2484,21.998 14.4554,21.8151 14.4934,21.577L 14.8684,18.9271C 15.4764,18.6741 16.0414,18.34 16.5574,17.9431L 19.0474,18.947C 19.2734,19.0341 19.5354,18.946 19.6594,18.73L 21.6594,15.2661C 21.7844,15.05 21.7294,14.78 21.5414,14.6271L 19.4284,12.9741 Z '/>
            </svg>
          </a>
        </span>
        <span class='select'>
          <select>
            <option>master</option>
            <option>gh-pages</option>
            <option>variant-1</option>
          </select>
        </span>
      </header>

      <section class='body'>
        <a>
          <svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' version='1.1' baseProfile='full' width='24' height='24' viewBox='0 0 24.00 24.00' enable-background='new 0 0 24.00 24.00' xml:space='preserve'>
          	<path stroke-linejoin='round' d='M 19,7L 9,7L 9,5L 19,5M 15,15L 9,15L 9,13L 15,13M 19,11L 9,11L 9,9L 19,9M 20,2L 8,2C 6.9,2 6,2.9 6,4L 6,16C 6,17.1 6.9,18 8,18L 20,18C 21.1,18 22,17.1 22,16L 22,4C 22,2.9 21.1,2 20,2 Z M 4,6L 2,6L 2,20C 2,21.1 2.9,22 4,22L 18,22L 18,20L 4,20L 4,6 Z '/>
          </svg>
          Pages
        </a>
        <a>
          <svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' version='1.1' baseProfile='full' width='24' height='24' viewBox='0 0 24.00 24.00' enable-background='new 0 0 24.00 24.00' xml:space='preserve'>
          	<path stroke-width='0.2' stroke-linejoin='round' d='M 5,2.9978C 3.89125,2.9978 2.9975,3.89136 2.9975,5L 2.9975,18.9988C 2.9975,20.1075 3.89125,21.0012 5,21.0012L 11.0013,21.0012L 11.0013,2.9978M 12.9975,2.9978L 12.9975,11.0012L 21.0013,11.0012L 21.0013,5C 21.0013,3.89136 20.1075,2.9978 18.9988,2.9978M 12.9975,12.9975L 12.9975,21.0012L 18.9988,21.0012C 20.1075,21.0012 21.0013,20.1075 21.0013,18.9988L 21.0013,12.9975'/>
          </svg>
          Includes
        </a>
        <h3>Collections</h3>
        <a class='active'>
          <svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' version='1.1' baseProfile='full' width='24' height='24' viewBox='0 0 24.00 24.00' enable-background='new 0 0 24.00 24.00' xml:space='preserve'>
          	<path stroke-linejoin='round' d='M 19,7L 9,7L 9,5L 19,5M 15,15L 9,15L 9,13L 15,13M 19,11L 9,11L 9,9L 19,9M 20,2L 8,2C 6.9,2 6,2.9 6,4L 6,16C 6,17.1 6.9,18 8,18L 20,18C 21.1,18 22,17.1 22,16L 22,4C 22,2.9 21.1,2 20,2 Z M 4,6L 2,6L 2,20C 2,21.1 2.9,22 4,22L 18,22L 18,20L 4,20L 4,6 Z '/>
          </svg>
          Posts
        </a>
        <a>
          <svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' version='1.1' baseProfile='full' width='24' height='24' viewBox='0 0 24.00 24.00' enable-background='new 0 0 24.00 24.00' xml:space='preserve'>
          	<path stroke-linejoin='round' d='M 19,7L 9,7L 9,5L 19,5M 15,15L 9,15L 9,13L 15,13M 19,11L 9,11L 9,9L 19,9M 20,2L 8,2C 6.9,2 6,2.9 6,4L 6,16C 6,17.1 6.9,18 8,18L 20,18C 21.1,18 22,17.1 22,16L 22,4C 22,2.9 21.1,2 20,2 Z M 4,6L 2,6L 2,20C 2,21.1 2.9,22 4,22L 18,22L 18,20L 4,20L 4,6 Z '/>
          </svg>
          Team
        </a>
        <a>
          <svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' version='1.1' baseProfile='full' width='24' height='24' viewBox='0 0 24.00 24.00' enable-background='new 0 0 24.00 24.00' xml:space='preserve'>
          	<path stroke-linejoin='round' d='M 19,7L 9,7L 9,5L 19,5M 15,15L 9,15L 9,13L 15,13M 19,11L 9,11L 9,9L 19,9M 20,2L 8,2C 6.9,2 6,2.9 6,4L 6,16C 6,17.1 6.9,18 8,18L 20,18C 21.1,18 22,17.1 22,16L 22,4C 22,2.9 21.1,2 20,2 Z M 4,6L 2,6L 2,20C 2,21.1 2.9,22 4,22L 18,22L 18,20L 4,20L 4,6 Z '/>
          </svg>
          Products
        </a>
      </section>

      <footer class='footer'>
        <span class='dropdown'>
          <a>
            <img src='assets/user.jpg'/>
            Ronan
          </a>
          <div class='options'>
            <a>Settings</a>
            <a class='separated'>Logout</a>
          </div>
        </span>
      </footer>
    </nav>

    <nav id='navigation'>
      <header class='header'>
        <div class='controls'>
          <button class='button primary'>
            <svg fill='#000000' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'>
                <path d='M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z'/>
                <path d='M0 0h24v24H0z' fill='none'/>
            </svg>
            <span>Add</span>
          </button>
        </div>
        <input type='text' class='search' placeholder='Filter by name'/>
      </header>

      <section class='body'>
        <a>
          <h2>Our job ads will never die</h2>
          <small class='meta'>Just now</small>
        </a>
        <a class='active'>
          <h2>Getting our backend Go-ing</h2>
          <small class='meta'>Yesterday</small>
        </a>
        <a>
          <h2>Yo Mayi</h2>
          <small class='meta'>2 days ago</small>
        </a>
        <a>
          <h2>Wiredcrat hits the beach</h2>
          <small class='meta'>3 days ago</small>
        </a>
        <a>
          <h2>Uncovering our tracks with link tagging and Google Analytics</h2>
          <small class='meta'>5 days ago</small>
        </a>
        <a>
          <h2>UI/UX Conference tickets are now on sale!</h2>
          <small class='meta'>A week ago</small>
        </a>
        <a>
          <h2>Our job ads will never die</h2>
          <small class='meta'>2 weeks ago</small>
        </a>
      </section>
    </nav>

    <!-- CONTENT -->
    <section id='content'>
      <aside class='sidebar'>
        <div class='field'>
          <label class='switch'>
            <input type='checkbox' id='draft'/>
            <div class='slider'></div>
          </label>
          <label for='draft'>Draft</label>
        </div>
        <div class='field'>
          <label class='switch'>
            <input type='checkbox' id='published' checked/>
            <div class='slider'></div>
          </label>
          <label for='published'>Published</label>
        </div>
        <button class='button primary'>Save</button>
        <button class='button danger'>Delete</button>
      </aside>

      <div class='body'>
        <div class='field'>
          <label>Title</label>
          <input type='text' placeholder=''/>
        </div>
        <div class='field'>
          <label>Body</label>
          <textarea rows='20'>---
published: false
title: Reduce load time and compress apps with code splitting
author: David
tags:
  - Code splitting
  - Load time
  - Webpack
excerpt: "Code splitting is a slick way to reduce initial file requests and speed up your load time. We're using it for building a massive single-page app for the World Bank."
preview: http://wiredcraft.com/images/posts/Code-splitting-single-page-app.png
---

![](http://wiredcraft.com/images/posts/Code-splitting-single-page-app.png)

Wiredcraft is currently rebuilding the [data.worldbank.org](http://data.worldbank.org) Open Data portal to be an SPA (single-page application) and to work well on mobile. The dataset has about 1500 different indicator time series for most countries and the portal can display these in graphs and heat maps. Since the site has so many dynamic pieces, we're using code splitting to improve the application's performance. Check out the [rebuilt site's beta mode](http://beta.data.worldbank.org).

## Why we need code splitting

SPA's client-side routing greatly reduces the round trip between the server and client. We also can use server side rendering (checkout reference about SSR implementation of [React](https://github.com/mhart/react-server-example) and [Angular2](https://github.com/angular/universal) to render the initial page in server, which cuts down the initial render time in the client side.

Still one common problem exists: the file's size request in the initial load becomes bigger when the application becomes larger. We handle this problem by creating on-demand loaded chunks, only requesting the essential files in the initial page. Once we enter different route or need to use some important features, we request those related chunks just once.

With the help of [Webpack](https://github.com/webpack/webpack) and [React router](https://github.com/rackt/react-router) (our application is based on React), we can implement these on-demand chunks very quickly.

We're using some iframes in the World Bank project that source from the original site. Splitting the code saves us more than 50% of the inital file request for the iframes, meaning they load super quickly.

## Webpack

Webpack is a famous module bundler and [here's a great article](http://christianalfoni.github.io/javascript/2014/12/13/did-you-know-webpack-and-react-is-awesome.html) for learning and using their product.
We can create on demand load chunks by define `split point` in our code.

Use `require.ensure(dependencies, callback)` to load CommonJs modules, Use `require(dependencies, callback)` to load AMD modules. Webpack will detect these split points in the building process.

React router
React router is a popular client side routing library based on React.
We can define routes in plain JavaScript object or declaratively.
Plain JavaScript way:

````js
let myRoute = {
  path: `${some path}`,
  childRoutes: [
    RouteA,
    RouteB,
    RouteC,
  ]
}
````

Declarative way:
````
const routes = (
  <Route component={Component}>
    <Route path="pathA" component={ComponentA}/>
    <Route path="pathB" component={ComponentB}/>
  </Route>
)
````

React router allows us to use lazy load route-related code, also called dynamic routing. We can define our split points in the lazy load code. ([Here's a reference about dynamic routing](https://github.com/rackt/react-router/blob/latest/docs/guides/advanced/DynamicRouting.md))

## Code Splitting Implement

Below is a demo of creating two on demand loaded chunks, chunk A will load once when entering rootUrl/A, chunk B will load once when entering rootUrl/B.

**Routes**

````
/* ---            RootRoute            --- */
...
import RouteA from './RouteA'
import RouteB from './RouteB'

export default {
  path: '/',
  component: App,
  childRoutes: [
    RouteA,
    RouteB,
  ],
  indexRoute: {
    component: Index
  }
}

/* ---              RouteA              --- */
...
export default {
  path: 'A',
  getComponent(location, cb) {
    require.ensure([], (require) => {
      cb(null, require(`${PathOfRelatedComponent}`))
    }, 'chunkA')
  }
}

/* ---              RouteB              --- */
...
export default {
  path: 'B',
  getComponent(location, cb) {
    require.ensure([], (require) => {
      cb(null, require(`${PathOfRelatedComponent}`))
    }, 'chunkB')
  }
}
````

**Client side code for client-side rendering**

````
import { match, Router } from 'react-router'

const { pathname, search, hash } = window.location
const location = `${pathname}${search}${hash}`

//use match to trigger the split code to load before rendering.
match({ routes, location }, () => {
  render(
    <Router routes={routes} history={createHistory()} />,
      document.getElementById('app')
  )
})
````

**Server code for server-side rendering**

````
app.createServer((req, res) => {
  match({ routes, location: req.url }, (error, redirectLocation, renderProps) => {
    if (error)
      writeError('ERROR!', res)
    else if (redirectLocation)
      redirect(redirectLocation, res)
    else if (renderProps)
      renderApp(renderProps, res)
    else
      writeNotFound(res)
}).listen(PORT)

function renderApp(props, res) {
  const markup = renderToString(<RoutingContext {...props}/>)
  const html = createPage(markup)
  write(html, 'text/html', res)
}

export function createPage(html) {
  return `
  <!doctype html>
  <html>
    <head>
      <meta charset="utf-8"/>
      <title>My Universal App</title>
    </head>
    <body>
      <div id="app">${html}</div>
      <script src="/__build__/main.js"></script>
    </body>
  </html>
  `
}
````

## Implementation hints

Depends on how you write your module, you may get error: `React.createElement: type should not be null, undefined, boolean, or number. It should be a string (for DOM elements) or a ReactClass (for composite components). Check the render method of RoutingContext.` Add `.default` after your component require to solve this problem.

If you got `require.ensure` is not function promoted, add this polyfill:`if (typeof require.ensure !== 'function') require.ensure = (d, c) => c(require)` which allow us replace `require.ensure` to `require` in server side.

## Putting it all back together

Code chunks improve the performance for apps, especially on mobile, by reducing the initial code size.  We can create chunks in two steps: define split points in routes and use react router's `match` in both client side and server side.

For more info on Webpack's code splitting, check out [their Github page](http://webpack.github.io/docs/code-splitting.html) and their [demo project](https://github.com/ryanflorence/example-react-router-server-rendering-lazy-routes).

See our work on the World Bank's [Open Data site](http://beta.data.worldbank.org) and tell us your thoughts via [Twitter](http://twitter.com/wiredcraft) or [email](mailto:info@wiredcraft.com)!</textarea>
          <small class='description'>For more details about the options, <a hre='http://google.com'>check our guide</a>.</small>
        </div>
      </div>
    </section>
  </div>
</body>
</html>
